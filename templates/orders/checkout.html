{% extends 'base/base.html' %}
{% load static %}

{% block title %}Checkout - 60 Seconds to Napoli{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/checkout.css' %}">
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Checkout Form -->
        <div class="col-lg-8">
            <div class="checkout-container">
                <!-- Progress Steps -->
                <div class="checkout-progress">
                    <div class="progress-steps">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">Delivery</div>
                        </div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">Payment</div>
                        </div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">Review</div>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Delivery Information -->
                <div class="checkout-step active" id="step-1">
                    <h4 class="mb-4">
                        <i class="fas fa-truck me-2"></i>
                        Delivery Information
                    </h4>

                    <!-- Order Type Selection -->
                    <div class="order-type-selector mb-4">
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="order_type" id="delivery" value="delivery" checked>
                            <label class="btn btn-outline-primary" for="delivery">
                                <i class="fas fa-truck me-2"></i>
                                Delivery
                            </label>

                            <input type="radio" class="btn-check" name="order_type" id="pickup" value="pickup">
                            <label class="btn btn-outline-primary" for="pickup">
                                <i class="fas fa-store me-2"></i>
                                Pickup
                            </label>
                        </div>
                    </div>

                    <!-- Delivery Form -->
                    <form id="delivery-form">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">First Name *</label>
                                <input type="text" class="form-control" id="first_name" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Last Name *</label>
                                <input type="text" class="form-control" id="last_name" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Email *</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Phone *</label>
                                <input type="tel" class="form-control" id="phone" required>
                            </div>
                            <div class="col-12 delivery-address">
                                <label class="form-label">Delivery Address *</label>
                                <input type="text" class="form-control" id="address" placeholder="Street Address" required>
                                <div class="row mt-2">
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" id="city" placeholder="City" required>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" id="postal_code" placeholder="Postal Code" required>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" id="country" placeholder="Country" value="Germany" required>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Delivery Instructions (Optional)</label>
                                <textarea class="form-control" id="delivery_instructions" rows="2" placeholder="e.g., Ring doorbell, leave at entrance"></textarea>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Delivery Time</label>
                                <select class="form-select" id="delivery_time">
                                    <option value="asap">ASAP (25-35 min)</option>
                                    <option value="30min">30 minutes</option>
                                    <option value="45min">45 minutes</option>
                                    <option value="1hour">1 hour</option>
                                    <option value="schedule">Schedule for later</option>
                                </select>
                            </div>
                        </div>
                    </form>

                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-secondary" onclick="goBack()">
                            <i class="fas fa-arrow-left me-2"></i>
                            Back to Cart
                        </button>
                        <button class="btn btn-primary" onclick="goToStep(2)">
                            Continue to Payment
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Payment Information -->
                <div class="checkout-step" id="step-2">
                    <h4 class="mb-4">
                        <i class="fas fa-credit-card me-2"></i>
                        Payment Method
                    </h4>

                    <!-- Payment Method Selection -->
                    <div class="payment-methods mb-4">
                        <div class="payment-method active" data-method="card">
                            <div class="payment-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="payment-details">
                                <div class="payment-name">Credit/Debit Card</div>
                                <div class="payment-desc">Visa, Mastercard, etc.</div>
                            </div>
                            <div class="payment-radio">
                                <input type="radio" name="payment_method" value="card" checked>
                            </div>
                        </div>

                        <div class="payment-method" data-method="paypal">
                            <div class="payment-icon">
                                <i class="fab fa-paypal"></i>
                            </div>
                            <div class="payment-details">
                                <div class="payment-name">PayPal</div>
                                <div class="payment-desc">Fast & Secure</div>
                            </div>
                            <div class="payment-radio">
                                <input type="radio" name="payment_method" value="paypal">
                            </div>
                        </div>

                        <div class="payment-method" data-method="cash">
                            <div class="payment-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="payment-details">
                                <div class="payment-name">Cash on Delivery</div>
                                <div class="payment-desc">Pay when you receive</div>
                            </div>
                            <div class="payment-radio">
                                <input type="radio" name="payment_method" value="cash">
                            </div>
                        </div>
                    </div>

                    <!-- Card Payment Form -->
                    <div id="card-payment-form" class="payment-form">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Card Number *</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="card_number" placeholder="1234 5678 9012 3456" maxlength="19">
                                    <span class="input-group-text">
                                        <i class="fab fa-cc-visa"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Expiry Date *</label>
                                <input type="text" class="form-control" id="card_expiry" placeholder="MM/YY" maxlength="5">
                            </div>
                            <div class="col-6">
                                <label class="form-label">CVV *</label>
                                <input type="text" class="form-control" id="card_cvv" placeholder="123" maxlength="3">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Cardholder Name *</label>
                                <input type="text" class="form-control" id="card_name" placeholder="John Doe">
                            </div>
                        </div>
                    </div>

                    <!-- PayPal Form (Placeholder) -->
                    <div id="paypal-form" class="payment-form" style="display: none;">
                        <div class="text-center py-4">
                            <i class="fab fa-paypal fa-3x text-primary mb-3"></i>
                            <p>You will be redirected to PayPal to complete your payment.</p>
                        </div>
                    </div>

                    <!-- Cash Form -->
                    <div id="cash-form" class="payment-form" style="display: none;">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Please have the exact amount ready. Our delivery partner will accept cash upon delivery.
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-secondary" onclick="goToStep(1)">
                            <i class="fas fa-arrow-left me-2"></i>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="goToStep(3)">
                            Review Order
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Order Review -->
                <div class="checkout-step" id="step-3">
                    <h4 class="mb-4">
                        <i class="fas fa-check-circle me-2"></i>
                        Review Your Order
                    </h4>

                    <!-- Order Summary -->
                    <div class="order-summary">
                        <h5 class="mb-3">Order Details</h5>
                        <div id="review-items">
                            <!-- Items will be populated dynamically -->
                        </div>

                        <div class="border-top mt-3 pt-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Subtotal:</span>
                                <span id="review-subtotal">0.00 €</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Tax (10%):</span>
                                <span id="review-tax">0.00 €</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Delivery:</span>
                                <span id="review-delivery">FREE</span>
                            </div>
                            <div class="d-flex justify-content-between fw-bold fs-5">
                                <span>Total:</span>
                                <span id="review-total">0.00 €</span>
                            </div>
                        </div>
                    </div>

                    <!-- Delivery Information Review -->
                    <div class="delivery-review mt-4">
                        <h5 class="mb-3">Delivery Information</h5>
                        <div id="review-delivery-info">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Payment Method Review -->
                    <div class="payment-review mt-4">
                        <h5 class="mb-3">Payment Method</h5>
                        <div id="review-payment-info">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Terms and Conditions -->
                    <div class="terms-section mt-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="terms_accepted">
                            <label class="form-check-label" for="terms_accepted">
                                I agree to the <a href="#" class="text-primary">Terms and Conditions</a> and understand that this order is final.
                            </label>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-secondary" onclick="goToStep(2)">
                            <i class="fas fa-arrow-left me-2"></i>
                            Back
                        </button>
                        <button class="btn btn-success btn-lg" id="place-order-btn" onclick="placeOrder()">
                            <i class="fas fa-check me-2"></i>
                            Place Order
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Summary Sidebar -->
        <div class="col-lg-4">
            <div class="order-summary-sidebar">
                <h5 class="mb-3">
                    <i class="fas fa-receipt me-2"></i>
                    Order Summary
                </h5>
                
                <div id="sidebar-items">
                    <!-- Items will be populated dynamically -->
                </div>

                <div class="border-top mt-3 pt-3">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal:</span>
                        <span id="sidebar-subtotal">0.00 €</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Tax:</span>
                        <span id="sidebar-tax">0.00 €</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Delivery:</span>
                        <span id="sidebar-delivery">FREE</span>
                    </div>
                    <div class="d-flex justify-content-between fw-bold fs-5">
                        <span>Total:</span>
                        <span id="sidebar-total">0.00 €</span>
                    </div>
                </div>

                <!-- Promo Code -->
                <div class="promo-section mt-3">
                    <div class="input-group">
                        <input type="text" class="form-control" id="promo_code" placeholder="Promo code">
                        <button class="btn btn-outline-primary" id="apply-promo">Apply</button>
                    </div>
                </div>

                <!-- Estimated Time -->
                <div class="estimated-time mt-3">
                    <div class="d-flex align-items-center text-muted">
                        <i class="fas fa-clock me-2"></i>
                        <small>Estimated delivery: <span id="estimated-time">25-35 min</span></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/checkout.js' %}"></script>
{% endblock %}
